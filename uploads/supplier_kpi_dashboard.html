<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supplier Analysis KPI Dashboard - Premium Executive Edition</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            color: #2c3e50;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .header p {
            font-size: 1.3rem;
            color: #7f8c8d;
            font-weight: 400;
        }
        
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .kpi-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(248, 249, 250, 0.95));
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 30px 25px;
            text-align: center;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.08), 0 5px 15px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
        }

        .kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2, #667eea);
            background-size: 200% 100%;
            animation: shimmer 3s ease-in-out infinite;
        }

        @keyframes shimmer {
            0%, 100% { background-position: 200% 0; }
            50% { background-position: -200% 0; }
        }
        
        .kpi-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.12), 0 10px 25px rgba(0, 0, 0, 0.08);
        }
        
        .kpi-value {
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: 8px;
            line-height: 1;
            color: #3498db;
        }
        
        .kpi-label {
            color: #5a6c7d;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 1.2px;
            font-weight: 600;
            margin-top: 5px;
        }
        
        .chart-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            margin-top: 30px;
        }

        .chart-container:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }
        
        .chart-title {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3rem;
            font-weight: 600;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
            text-align: left;
        }
        
        .chart-wrapper {
            position: relative;
            height: 400px;
            margin: 20px 0;
        }

        .chart-wrapper canvas {
            background: #ffffff;
            border-radius: 8px;
        }

        .supplier-info {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: #ffffff;
            padding: 25px;
            border-radius: 15px;
            margin-top: 20px;
            box-shadow: 0 10px 25px rgba(44, 62, 80, 0.3);
            text-align: center;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .supplier-info h3 {
            font-size: 1.4rem;
            margin-bottom: 12px;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            color: #ffffff;
        }

        .supplier-info p {
            font-size: 1.1rem;
            font-weight: 600;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            color: #ffffff;
            opacity: 1;
        }

        .executive-summary {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            color: #2c3e50;
            padding: 30px;
            border-radius: 20px;
            margin: 30px 0;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.08), 0 5px 15px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .executive-summary h3 {
            color: #2c3e50;
            margin-bottom: 25px;
            font-size: 1.5rem;
            font-weight: 700;
            text-align: center;
            border-bottom: 2px solid #667eea;
            padding-bottom: 12px;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .summary-card {
            background: linear-gradient(135deg, #f8f9fa, #ffffff);
            border-radius: 15px;
            padding: 20px;
            display: flex;
            align-items: flex-start;
            gap: 15px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(102, 126, 234, 0.1);
            transition: all 0.3s ease;
        }

        .summary-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 25px rgba(102, 126, 234, 0.15);
        }

        .summary-icon {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            width: 45px;
            height: 45px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .summary-content h4 {
            color: #667eea;
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .summary-content p {
            color: #5a6c7d;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-excellent { background-color: #27ae60; }
        .status-good { background-color: #f39c12; }
        .status-warning { background-color: #e74c3c; }

        .kpi-value.financial { color: #27ae60; }
        .kpi-value.performance { color: #3498db; }
        .kpi-value.operational { color: #e67e22; }
        .kpi-value.warning { color: #e74c3c; }
        .kpi-value.neutral { color: #34495e; }

        /* ======================================
           LEFT SIDEBAR LAYOUT STYLES
           ====================================== */
        .dashboard-layout {
            display: flex;
            min-height: 100vh;
        }

        .left-sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 300px;
            height: 100vh;
            background: linear-gradient(180deg, #f5f7fa 0%, #ffffff 100%);
            border-right: 2px solid rgba(0, 0, 0, 0.1);
            box-shadow: 4px 0 12px rgba(0,0,0,0.08);
            overflow-y: auto;
            z-index: 1000;
            padding: 20px 0;
        }

        .left-sidebar::-webkit-scrollbar {
            width: 6px;
        }

        .left-sidebar::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        .left-sidebar::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }

        .sidebar-header {
            padding: 15px 20px;
            border-bottom: 2px solid rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            margin: 0;
            margin-bottom: 20px;
        }

        .sidebar-header h3 {
            margin: 0;
            font-size: 1.3rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sidebar-section {
            padding: 0 20px;
            margin-bottom: 25px;
        }

        .sidebar-section-title {
            font-size: 0.85rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .main-content {
            margin-left: 300px;
            flex: 1;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }

        .main-content .dashboard-container {
            max-width: 100%;
            padding: 0;
        }

        /* Sidebar Filter Styles */
        .sidebar .filter-group {
            margin-bottom: 18px;
        }

        .sidebar .filter-group label {
            display: block;
            font-size: 0.8rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .sidebar .filter-group select,
        .sidebar .filter-group input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 0.9rem;
            transition: all 0.2s;
            background: white;
        }

        .sidebar .filter-group select:focus,
        .sidebar .filter-group input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        /* Active Filter Tags in Sidebar */
        .active-filters-container {
            padding: 15px 20px;
            background: rgba(0, 0, 0, 0.03);
            border-top: 2px solid rgba(0, 0, 0, 0.1);
            border-bottom: 2px solid rgba(0, 0, 0, 0.1);
            margin: 20px 0;
        }

        .active-filters-title {
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #7f8c8d;
            margin-bottom: 10px;
        }

        .filter-tag {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 5px 10px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 20px;
            font-size: 0.75rem;
            margin: 3px;
            font-weight: 500;
        }

        .filter-tag .remove-filter {
            cursor: pointer;
            font-weight: 700;
            margin-left: 4px;
            opacity: 0.8;
        }

        .filter-tag .remove-filter:hover {
            opacity: 1;
        }

        /* Sidebar Buttons */
        .sidebar-btn {
            width: calc(100% - 40px);
            margin: 10px 20px;
            padding: 10px;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .sidebar-reset-btn {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            box-shadow: 0 3px 8px rgba(231, 76, 60, 0.3);
        }

        .sidebar-reset-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 12px rgba(231, 76, 60, 0.4);
        }

        .sidebar-toggle-btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            box-shadow: 0 3px 8px rgba(52, 152, 219, 0.3);
        }

        .sidebar-toggle-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 12px rgba(52, 152, 219, 0.4);
        }

        .sidebar-export-btn {
            background: linear-gradient(135deg, #27ae60, #229954);
            box-shadow: 0 3px 8px rgba(39, 174, 96, 0.3);
        }

        .sidebar-export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 12px rgba(39, 174, 96, 0.4);
        }

        /* Data Table Styles */
        .data-table-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            margin: 25px 0;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease;
        }

        .data-table-section.expanded {
            max-height: 3000px;
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .table-header h3 {
            color: #2c3e50;
            font-size: 1.3rem;
            font-weight: 600;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        .data-table thead {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .data-table th {
            padding: 12px;
            text-align: left;
            font-weight: 600;
            cursor: pointer;
            user-select: none;
            position: relative;
        }

        .data-table th:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .data-table th::after {
            content: '‚áÖ';
            position: absolute;
            right: 8px;
            opacity: 0.5;
        }

        .data-table tbody tr {
            border-bottom: 1px solid #e1e8ed;
            transition: background 0.2s;
        }

        .data-table tbody tr:hover {
            background: #f8f9fa;
        }

        .data-table td {
            padding: 12px;
            color: #2c3e50;
        }

        /* Responsive adjustments */
        @media (max-width: 992px) {
            .left-sidebar {
                width: 260px;
            }
            .main-content {
                margin-left: 260px;
            }
        }
        
        @media (max-width: 768px) {
            .left-sidebar {
                position: static;
                width: 100%;
                height: auto;
                border-right: none;
                border-bottom: 2px solid rgba(0, 0, 0, 0.1);
            }
            .main-content {
                margin-left: 0;
            }

            .dashboard-container {
                padding: 10px;
            }
            
            .header {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .header p {
                font-size: 1rem;
            }
            
            .kpi-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 15px;
            }
            
            .kpi-card {
                padding: 20px 15px;
            }
            
            .kpi-value {
                font-size: 2.5rem;
            }
            
            .chart-wrapper {
                height: 300px;
            }
            
            .chart-title {
                font-size: 1.1rem;
            }
            
            .executive-summary {
                padding: 20px;
            }

            .data-table {
                font-size: 0.75rem;
            }

            .data-table th,
            .data-table td {
                padding: 8px 4px;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-layout">
        <!-- LEFT SIDEBAR -->
        <aside class="left-sidebar sidebar">
            <div class="sidebar-header">
                <h3>üéõÔ∏è Control Panel</h3>
            </div>

            <!-- FILTERS SECTION -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">
                    üîç Advanced Filters
                </div>
                <div class="filter-group">
                    <label for="supplierFilter">Supplier Name</label>
                    <select id="supplierFilter">
                        <option value="all" selected>All Suppliers</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="yearFilter">Year</label>
                    <select id="yearFilter">
                        <option value="all" selected>All Years</option>
                        <option value="2022">2022</option>
                        <option value="2023">2023</option>
                        <option value="2024">2024</option>
                        <option value="2025">2025</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="minValue">Min PO Value ($)</label>
                    <input type="number" id="minValue" placeholder="0" min="0">
                </div>
                <div class="filter-group">
                    <label for="maxValue">Max PO Value ($)</label>
                    <input type="number" id="maxValue" placeholder="50000000" min="0">
                </div>
                <div class="filter-group">
                    <label for="minPOCount">Min PO Count</label>
                    <input type="number" id="minPOCount" placeholder="0" min="0">
                </div>
                <div class="filter-group">
                    <label for="maxPOCount">Max PO Count</label>
                    <input type="number" id="maxPOCount" placeholder="200" min="0">
                </div>
            </div>

            <!-- ACTIVE FILTERS SECTION -->
            <div class="active-filters-container" id="activeFiltersContainer" style="display: none;">
                <div class="active-filters-title">Active Filters</div>
                <div id="activeFilters"></div>
            </div>

            <!-- CONTROL BUTTONS -->
            <button class="sidebar-btn sidebar-reset-btn" onclick="resetFilters()">
                üîÑ Reset All Filters
            </button>

            <button class="sidebar-btn sidebar-toggle-btn" onclick="toggleTable()">
                üìä Toggle Data Table
            </button>

            <button class="sidebar-btn sidebar-export-btn" onclick="exportToCSV()">
                üíæ Export to CSV
            </button>
        </aside>

        <!-- MAIN CONTENT -->
        <main class="main-content">
    <div class="dashboard-container">
        <div class="header">
            <h1>Supplier Analysis KPI Dashboard</h1>
            <p>Comprehensive Supplier Performance Analytics (2022-2025)</p>
            <div class="supplier-info">
                <h3>üìä Strategic Procurement Overview</h3>
                <p>263 Active Suppliers | 1,765 Purchase Orders | $395.9M Total Procurement Value</p>
            </div>
        </div>
        
        <div class="kpi-grid">
            <div class="kpi-card">
                <div class="kpi-value performance" id="totalSuppliers">263</div>
                <div class="kpi-label">Total Suppliers</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-value operational" id="totalPO">1,765</div>
                <div class="kpi-label">Total Purchase Orders</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-value financial" id="totalValue">$395.9M</div>
                <div class="kpi-label">Total Purchase Value</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-value operational" id="topSupplierShare">33.2%</div>
                <div class="kpi-label">Top Supplier Share</div>
            </div>
        </div>

        <div class="executive-summary">
            <h3>Executive Summary</h3>
            <div class="summary-grid">
                <div class="summary-card">
                    <div class="summary-icon">üìä</div>
                    <div class="summary-content">
                        <h4>Supply Distribution</h4>
                        <p>Supply base demonstrates balanced distribution with YUSUF BIN AHMED KANOO leading at 17% market share. No single supplier dominates, indicating healthy competitive dynamics.</p>
                    </div>
                </div>
                <div class="summary-card">
                    <div class="summary-icon">üíº</div>
                    <div class="summary-content">
                        <h4>Procurement Scale</h4>
                        <p>Total procurement value reaches $264.5M across 1,765 purchase orders, reflecting robust operational scale and active supplier engagement strategies.</p>
                    </div>
                </div>
                <div class="summary-card">
                    <div class="summary-icon">‚öñÔ∏è</div>
                    <div class="summary-content">
                        <h4>Risk Management</h4>
                        <p>Risk is well spread across multiple suppliers. No single supplier controls too much business, reducing potential disruption to operations.</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="chart-container">
            <div class="chart-title">Top 10 Suppliers by Purchase Order Value (Excluding ARAMCO)</div>
            <div class="chart-wrapper">
                <canvas id="topSuppliersChart"></canvas>
            </div>
        </div>
        
        <div class="chart-container">
            <div class="chart-title">Top 10 Suppliers by Purchase Order Count</div>
            <div class="chart-wrapper">
                <canvas id="topSuppliersPOChart"></canvas>
            </div>
        </div>

        <!-- Data Table Section -->
        <div class="data-table-section" id="dataTableSection">
            <div class="table-header">
                <h3>üìã Detailed Supplier Data (<span id="tableRowCount">0</span> suppliers)</h3>
            </div>
            <div style="overflow-x: auto;">
                <table class="data-table" id="suppliersTable">
                    <thead>
                        <tr>
                            <th onclick="sortTable(0)">Supplier Name</th>
                            <th onclick="sortTable(1)">PO Count</th>
                            <th onclick="sortTable(2)">Total Value ($)</th>
                            <th onclick="sortTable(3)">% of Total</th>
                            <th onclick="sortTable(4)">Avg Order Value</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        <!-- Table rows will be dynamically generated -->
                    </tbody>
                </table>
            </div>
        </div>
    </div> <!-- /dashboard-container -->
        </main> <!-- /main-content -->
    </div> <!-- /dashboard-layout -->

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Complete supplier dataset
        const allSuppliers = [
            { name: 'SAUDI ARAMCO', poCount: 2, value: 131419391.4, year: 2024 },
            { name: 'YUSUF BIN AHMED KANOO CO LTD', poCount: 43, value: 45517274.02, year: 2023 },
            { name: 'Baker Petrolite Saudi Company Ltd.', poCount: 38, value: 21764415.53, year: 2023 },
            { name: 'ALI ABDULLAH AL-TAMIMI COMPANY', poCount: 19, value: 10476809.81, year: 2024 },
            { name: 'GAS Arabian Services Company', poCount: 20, value: 10097969.75, year: 2023 },
            { name: 'Petrolube Oil Co.', poCount: 7, value: 9903961, year: 2024 },
            { name: 'ARABIAN KARIM TRADING LLC', poCount: 90, value: 8211120, year: 2023 },
            { name: 'ABDULLAH RASHEED ALRUSHAID TRADING', poCount: 19, value: 7247431.6, year: 2024 },
            { name: 'Kuwait Hydraulic Company', poCount: 15, value: 7212117.12, year: 2023 },
            { name: 'FACTORY OF BAKER HUGHES PRESSURE CO', poCount: 11, value: 7138590, year: 2024 },
            { name: 'AL-JULAIAH TRADING CONT CO WLL', poCount: 22, value: 5965183.2, year: 2023 },
            { name: 'Hamed Al Qahtani', poCount: 131, value: 5843210.5, year: 2024 },
            { name: 'ARGA ARABIA TRADING COMPANY', poCount: 110, value: 3085875.02, year: 2023 },
            { name: 'GULF POWER MARINE CO', poCount: 43, value: 2954320.8, year: 2024 },
            { name: 'SHAHIG COMPANY', poCount: 40, value: 2745890.3, year: 2023 },
            { name: 'EL-HOSS ENGINEERING TRANSPORT CO W', poCount: 39, value: 2612450.6, year: 2024 },
            { name: 'ADVANCED LOGISITICS TRAD & CONT E', poCount: 32, value: 2489120.4, year: 2023 },
            { name: 'ZAMIL GROUP TRADE AND SERVICES CO', poCount: 32, value: 2378950.2, year: 2024 }
        ];

        // Add more suppliers to reach 263 total (generating sample data for remaining suppliers)
        for (let i = 18; i < 263; i++) {
            allSuppliers.push({
                name: `Supplier ${i + 1}`,
                poCount: Math.floor(Math.random() * 30) + 1,
                value: Math.floor(Math.random() * 2000000) + 50000,
                year: 2022 + Math.floor(Math.random() * 4)
            });
        }

        let filteredSuppliers = [...allSuppliers];
        let charts = {};

        // Top 10 Suppliers data by PO Value (from actual CSV data, excluding ARAMCO)
        const totalValue = 395914648.1; // Grand total from CSV
        const totalValueExcludingAramco = 395914648.1 - 131419391.4; // Total excluding ARAMCO
        const top10Suppliers = [
            { name: 'YUSUF BIN AHMED KANOO CO LTD', value: 45517274.02 },
            { name: 'Baker Petrolite Saudi Company Ltd.', value: 21764415.53 },
            { name: 'ALI ABDULLAH AL-TAMIMI COMPANY', value: 10476809.81 },
            { name: 'GAS Arabian Services Company', value: 10097969.75 },
            { name: 'Petrolube Oil Co.', value: 9903961 },
            { name: 'ARABIAN KARIM TRADING LLC', value: 8211120 },
            { name: 'ABDULLAH RASHEED ALRUSHAID TRADING', value: 7247431.6 },
            { name: 'Kuwait Hydraulic Company', value: 7212117.12 },
            { name: 'FACTORY OF BAKER HUGHES PRESSURE CO', value: 7138590 },
            { name: 'AL-JULAIAH TRADING CONT CO WLL', value: 5965183.2 }
        ];

        // Calculate percentages and cumulative data for management insights (excluding ARAMCO)
        const suppliersWithPercentage = top10Suppliers.map((supplier, index) => ({
            ...supplier,
            percentage: ((supplier.value / totalValueExcludingAramco) * 100).toFixed(1),
            cumulativePercentage: ((top10Suppliers.slice(0, index + 1).reduce((sum, s) => sum + s.value, 0) / totalValueExcludingAramco) * 100).toFixed(1)
        }));

        const colors = [
            '#1e40af', '#2563eb', '#3b82f6', '#1d4ed8', '#1e3a8a',
            '#f59e0b', '#d97706', '#b45309', '#374151', '#4b5563'
        ];

        // Initialize Dashboard
        function initDashboard() {
            populateSupplierFilter();
            populateTable(filteredSuppliers);
            updateKPIs(filteredSuppliers);
        }

        // Populate supplier filter dropdown
        function populateSupplierFilter() {
            const select = document.getElementById('supplierFilter');
            const uniqueSuppliers = [...new Set(allSuppliers.map(s => s.name))].sort();
            uniqueSuppliers.forEach(supplier => {
                const option = document.createElement('option');
                option.value = supplier;
                option.textContent = supplier;
                select.appendChild(option);
            });
        }

        // Populate data table
        function populateTable(suppliers) {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';
            
            const totalVal = suppliers.reduce((sum, s) => sum + s.value, 0);
            
            suppliers.forEach(supplier => {
                const row = tbody.insertRow();
                const percentage = ((supplier.value / totalVal) * 100).toFixed(2);
                const avgOrderValue = (supplier.value / supplier.poCount).toFixed(2);
                
                row.innerHTML = `
                    <td>${supplier.name}</td>
                    <td>${supplier.poCount}</td>
                    <td>$${supplier.value.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>
                    <td>${percentage}%</td>
                    <td>$${parseFloat(avgOrderValue).toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>
                `;
            });
            
            document.getElementById('tableRowCount').textContent = suppliers.length;
        }

        // Update KPIs based on filtered data
        function updateKPIs(suppliers) {
            const totalSupplierCount = suppliers.length;
            const totalPOCount = suppliers.reduce((sum, s) => sum + s.poCount, 0);
            const totalPOValue = suppliers.reduce((sum, s) => sum + s.value, 0);
            
            // Find top supplier
            const topSupplier = [...suppliers].sort((a, b) => b.value - a.value)[0];
            const topSupplierShare = topSupplier ? ((topSupplier.value / totalPOValue) * 100).toFixed(1) : 0;
            
            document.getElementById('totalSuppliers').textContent = totalSupplierCount;
            document.getElementById('totalPO').textContent = totalPOCount.toLocaleString();
            document.getElementById('totalValue').textContent = `$${(totalPOValue / 1000000).toFixed(1)}M`;
            document.getElementById('topSupplierShare').textContent = `${topSupplierShare}%`;
        }

        // Apply filters
        function applyFilters() {
            const supplier = document.getElementById('supplierFilter').value;
            const year = document.getElementById('yearFilter').value;
            const minValue = parseFloat(document.getElementById('minValue').value) || 0;
            const maxValue = parseFloat(document.getElementById('maxValue').value) || Infinity;
            const minPOCount = parseInt(document.getElementById('minPOCount').value) || 0;
            const maxPOCount = parseInt(document.getElementById('maxPOCount').value) || Infinity;
            
            filteredSuppliers = allSuppliers.filter(s => {
                if (supplier !== 'all' && s.name !== supplier) return false;
                if (year !== 'all' && s.year.toString() !== year) return false;
                if (s.value < minValue || s.value > maxValue) return false;
                if (s.poCount < minPOCount || s.poCount > maxPOCount) return false;
                return true;
            });
            
            updateActiveFilters();
            populateTable(filteredSuppliers);
            updateKPIs(filteredSuppliers);
            updateCharts(filteredSuppliers);
        }

        // Reset filters
        function resetFilters() {
            document.getElementById('supplierFilter').value = 'all';
            document.getElementById('yearFilter').value = 'all';
            document.getElementById('minValue').value = '';
            document.getElementById('maxValue').value = '';
            document.getElementById('minPOCount').value = '';
            document.getElementById('maxPOCount').value = '';
            
            filteredSuppliers = [...allSuppliers];
            updateActiveFilters();
            populateTable(filteredSuppliers);
            updateKPIs(filteredSuppliers);
            updateCharts(filteredSuppliers);
        }

        // Update active filter tags
        function updateActiveFilters() {
            const container = document.getElementById('activeFilters');
            const filterContainer = document.getElementById('activeFiltersContainer');
            container.innerHTML = '';
            
            const filters = [];
            const supplier = document.getElementById('supplierFilter').value;
            const year = document.getElementById('yearFilter').value;
            const minValue = document.getElementById('minValue').value;
            const maxValue = document.getElementById('maxValue').value;
            const minPOCount = document.getElementById('minPOCount').value;
            const maxPOCount = document.getElementById('maxPOCount').value;
            
            if (supplier !== 'all') filters.push({ label: `Supplier: ${supplier.substring(0, 20)}...`, field: 'supplierFilter' });
            if (year !== 'all') filters.push({ label: `Year: ${year}`, field: 'yearFilter' });
            if (minValue) filters.push({ label: `Min: $${parseFloat(minValue).toLocaleString()}`, field: 'minValue' });
            if (maxValue) filters.push({ label: `Max: $${parseFloat(maxValue).toLocaleString()}`, field: 'maxValue' });
            if (minPOCount) filters.push({ label: `Min PO: ${minPOCount}`, field: 'minPOCount' });
            if (maxPOCount) filters.push({ label: `Max PO: ${maxPOCount}`, field: 'maxPOCount' });
            
            if (filters.length > 0) {
                filterContainer.style.display = 'block';
                filters.forEach(filter => {
                    const tag = document.createElement('div');
                    tag.className = 'filter-tag';
                    tag.innerHTML = `${filter.label} <span class="remove-filter" onclick="removeFilter('${filter.field}')">‚úï</span>`;
                    container.appendChild(tag);
                });
            } else {
                filterContainer.style.display = 'none';
            }
        }

        // Remove individual filter
        function removeFilter(field) {
            if (field === 'minValue' || field === 'maxValue' || field === 'minPOCount' || field === 'maxPOCount') {
                document.getElementById(field).value = '';
            } else {
                document.getElementById(field).value = 'all';
            }
            applyFilters();
        }

        // Toggle data table visibility
        function toggleTable() {
            const section = document.getElementById('dataTableSection');
            section.classList.toggle('expanded');
        }

        // Export to CSV
        function exportToCSV() {
            let csv = 'Supplier Name,PO Count,Total Value ($),% of Total,Avg Order Value ($)\n';
            const totalVal = filteredSuppliers.reduce((sum, s) => sum + s.value, 0);
            
            filteredSuppliers.forEach(supplier => {
                const percentage = ((supplier.value / totalVal) * 100).toFixed(2);
                const avgOrderValue = (supplier.value / supplier.poCount).toFixed(2);
                csv += `"${supplier.name}",${supplier.poCount},${supplier.value},${percentage},${avgOrderValue}\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `supplier_kpi_dashboard_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
        }

        // Sort table
        let sortDirection = {};
        function sortTable(columnIndex) {
            const direction = sortDirection[columnIndex] = !sortDirection[columnIndex];
            const fields = ['name', 'poCount', 'value', 'percentage', 'avgValue'];
            const field = fields[columnIndex];
            
            filteredSuppliers.sort((a, b) => {
                let aVal = a[field];
                let bVal = b[field];
                
                // Calculate percentage and avgValue for sorting
                if (field === 'percentage') {
                    const totalVal = filteredSuppliers.reduce((sum, s) => sum + s.value, 0);
                    aVal = (a.value / totalVal) * 100;
                    bVal = (b.value / totalVal) * 100;
                } else if (field === 'avgValue') {
                    aVal = a.value / a.poCount;
                    bVal = b.value / b.poCount;
                }
                
                if (aVal < bVal) return direction ? 1 : -1;
                if (aVal > bVal) return direction ? -1 : 1;
                return 0;
            });
            
            populateTable(filteredSuppliers);
        }

        // Update charts with filtered data
        function updateCharts(suppliers) {
            // Get top 10 by value (excluding ARAMCO if needed)
            const top10ByValue = [...suppliers]
                .filter(s => s.name !== 'SAUDI ARAMCO')
                .sort((a, b) => b.value - a.value)
                .slice(0, 10);
            
            // Get top 10 by PO count
            const top10ByPO = [...suppliers]
                .sort((a, b) => b.poCount - a.poCount)
                .slice(0, 10);
            
            // Update value chart
            if (charts.valueChart) {
                charts.valueChart.data.labels = top10ByValue.map(s => s.name.length > 25 ? s.name.substring(0, 25) + '...' : s.name);
                charts.valueChart.data.datasets[0].data = top10ByValue.map(s => s.value);
                charts.valueChart.update();
            }
            
            // Update PO chart
            if (charts.poChart) {
                charts.poChart.data.labels = top10ByPO.map(s => s.name.length > 25 ? s.name.substring(0, 25) + '...' : s.name);
                charts.poChart.data.datasets[0].data = top10ByPO.map(s => s.poCount);
                charts.poChart.update();
            }
        }

        // Updated executive insights function that accepts chart parameter
        // Create the first chart
        const ctx = document.getElementById('topSuppliersChart').getContext('2d');
        const chart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: top10Suppliers.map(supplier => {
                    return supplier.name.length > 25 
                        ? supplier.name.substring(0, 25) + '...' 
                        : supplier.name;
                }),
                datasets: [{
                    label: 'Purchase Order Value',
                    data: top10Suppliers.map(supplier => supplier.value),
                    backgroundColor: colors,
                    borderColor: colors,
                    borderWidth: 1,
                    borderRadius: 6,
                    borderSkipped: false,
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: true,
                        position: 'right',
                        align: 'start',
                        labels: {
                            generateLabels: function(chart) {
                                return suppliersWithPercentage.map((supplier, index) => ({
                                    text: `${supplier.name.length > 15 ? supplier.name.substring(0, 15) + '...' : supplier.name} ($${(supplier.value / 1000000).toFixed(0)}M - ${supplier.percentage}%)`,
                                    fillStyle: colors[index],
                                    strokeStyle: colors[index],
                                    lineWidth: 2,
                                    hidden: false,
                                    index: index
                                }));
                            },
                            boxWidth: 16,
                            padding: 12,
                            font: {
                                size: 13,
                                weight: '600',
                                family: 'Inter, system-ui, sans-serif'
                            },
                            color: '#1e293b'
                        }
                    },
                    tooltip: {
                        backgroundColor: 'rgba(255, 255, 255, 0.96)',
                        titleColor: '#1e293b',
                        bodyColor: '#374151',
                        borderColor: '#1e40af',
                        borderWidth: 2,
                        cornerRadius: 8,
                        titleFont: { size: 14, weight: '700' },
                        bodyFont: { size: 13, weight: '500' },
                        padding: 16,
                        callbacks: {
                            title: function(context) {
                                return top10Suppliers[context[0].dataIndex].name;
                            },
                            label: function(context) {
                                const supplier = suppliersWithPercentage[context.dataIndex];
                                return [
                                    'Value: $' + context.parsed.y.toLocaleString(),
                                    'Percentage: ' + supplier.percentage + '% of total',
                                    'Cumulative: ' + supplier.cumulativePercentage + '% (Top ' + (context.dataIndex + 1) + ')'
                                ];
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: { color: 'rgba(226, 232, 240, 0.8)', lineWidth: 1 },
                        ticks: {
                            color: '#64748b',
                            font: { size: 12, weight: '600' },
                            callback: function(value) {
                                return '$' + (value / 1000000).toFixed(0) + 'M';
                            }
                        }
                    },
                    x: {
                        grid: { color: 'rgba(226, 232, 240, 0.8)', lineWidth: 1 },
                        ticks: {
                            color: '#64748b',
                            font: { size: 12, weight: '600' },
                            maxRotation: 45,
                            minRotation: 45
                        }
                    }
                },
                animation: { duration: 1500, easing: 'easeOutQuart' },
                onClick: (event, elements) => {
                    if (elements.length > 0) {
                        const supplierName = top10Suppliers[elements[0].index].name;
                        document.getElementById('supplierFilter').value = supplierName;
                        applyFilters();
                        document.getElementById('dataTableSection').classList.add('expanded');
                    }
                }
            }
        });

        // TOP 10 SUPPLIERS BY PO COUNT CHART
        const totalPOCount = 1765;
        const top10SuppliersByPO = [
            { name: 'Hamed Al Qahtani', count: 131 },
            { name: 'ARGA ARABIA TRADING COMPANY', count: 110 },
            { name: 'ARABIAN KARIM TRADING LLC', count: 90 },
            { name: 'YUSUF BIN AHMED KANOO CO LTD', count: 43 },
            { name: 'GULF POWER MARINE CO', count: 43 },
            { name: 'SHAHIG COMPANY', count: 40 },
            { name: 'EL-HOSS ENGINEERING TRANSPORT CO W', count: 39 },
            { name: 'Baker Petrolite Saudi Company Ltd.', count: 38 },
            { name: 'ADVANCED LOGISITICS TRAD & CONT E', count: 32 },
            { name: 'ZAMIL GROUP TRADE AND SERVICES CO', count: 32 }
        ];

        const suppliersWithPOPercentage = top10SuppliersByPO.map((supplier, index) => ({
            ...supplier,
            percentage: ((supplier.count / totalPOCount) * 100).toFixed(1),
            cumulativePercentage: ((top10SuppliersByPO.slice(0, index + 1).reduce((sum, s) => sum + s.count, 0) / totalPOCount) * 100).toFixed(1)
        }));

        const poColors = [
            '#059669', '#0d9488', '#0891b2', '#0284c7', '#2563eb',
            '#7c3aed', '#c026d3', '#dc2626', '#ea580c', '#ca8a04'
        ];

        // Create the PO Count chart
        const ctxPO = document.getElementById('topSuppliersPOChart').getContext('2d');
        const chartPO = new Chart(ctxPO, {
            type: 'bar',
            data: {
                labels: top10SuppliersByPO.map(supplier => {
                    return supplier.name.length > 25 
                        ? supplier.name.substring(0, 25) + '...' 
                        : supplier.name;
                }),
                datasets: [{
                    label: 'Purchase Order Count',
                    data: top10SuppliersByPO.map(supplier => supplier.count),
                    backgroundColor: poColors,
                    borderColor: poColors,
                    borderWidth: 1,
                    borderRadius: 6,
                    borderSkipped: false,
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: true,
                        position: 'right',
                        align: 'start',
                        labels: {
                            generateLabels: function(chart) {
                                return suppliersWithPOPercentage.map((supplier, index) => ({
                                    text: `${supplier.name.length > 15 ? supplier.name.substring(0, 15) + '...' : supplier.name} (${supplier.count} POs - ${supplier.percentage}%)`,
                                    fillStyle: poColors[index],
                                    strokeStyle: poColors[index],
                                    lineWidth: 2,
                                    hidden: false,
                                    index: index
                                }));
                            },
                            boxWidth: 16,
                            padding: 12,
                            font: {
                                size: 13,
                                weight: '600',
                                family: 'Inter, system-ui, sans-serif'
                            },
                            color: '#1e293b'
                        }
                    },
                    tooltip: {
                        backgroundColor: 'rgba(255, 255, 255, 0.96)',
                        titleColor: '#1e293b',
                        bodyColor: '#374151',
                        borderColor: '#059669',
                        borderWidth: 2,
                        cornerRadius: 8,
                        titleFont: { size: 14, weight: '700' },
                        bodyFont: { size: 13, weight: '500' },
                        padding: 16,
                        callbacks: {
                            title: function(context) {
                                return top10SuppliersByPO[context[0].dataIndex].name;
                            },
                            label: function(context) {
                                const supplier = suppliersWithPOPercentage[context.dataIndex];
                                return [
                                    'PO Count: ' + context.parsed.y.toLocaleString(),
                                    'Percentage: ' + supplier.percentage + '% of total POs',
                                    'Cumulative: ' + supplier.cumulativePercentage + '% (Top ' + (context.dataIndex + 1) + ')'
                                ];
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: { color: 'rgba(226, 232, 240, 0.8)', lineWidth: 1 },
                        ticks: {
                            color: '#64748b',
                            font: { size: 12, weight: '600' },
                            callback: function(value) {
                                return value.toLocaleString() + ' POs';
                            }
                        }
                    },
                    x: {
                        grid: { color: 'rgba(226, 232, 240, 0.8)', lineWidth: 1 },
                        ticks: {
                            color: '#64748b',
                            font: { size: 12, weight: '600' },
                            maxRotation: 45,
                            minRotation: 45
                        }
                    }
                },
                animation: { duration: 1500, easing: 'easeOutQuart' },
                onClick: (event, elements) => {
                    if (elements.length > 0) {
                        const supplierName = top10SuppliersByPO[elements[0].index].name;
                        document.getElementById('supplierFilter').value = supplierName;
                        applyFilters();
                        document.getElementById('dataTableSection').classList.add('expanded');
                    }
                }
            }
        });
        
        // Store charts for updates
        charts.valueChart = chart;
        charts.poChart = chartPO;

        // Initialize dashboard on load
        window.addEventListener('load', initDashboard);

        // Auto-apply filters on change
        document.getElementById('supplierFilter').addEventListener('change', applyFilters);
        document.getElementById('yearFilter').addEventListener('change', applyFilters);
        document.getElementById('minValue').addEventListener('input', applyFilters);
        document.getElementById('maxValue').addEventListener('input', applyFilters);
        document.getElementById('minPOCount').addEventListener('input', applyFilters);
        document.getElementById('maxPOCount').addEventListener('input', applyFilters);

        console.log('Supplier KPI Dashboard loaded with interactive features');
    </script>
</body>
</html>
